<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manual de Empleo - Sniff: Analizador de Paquetes de Red</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px 0;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        header h1 {
            margin: 0;
            font-size: 2.5em;
        }

        header p {
            margin: 10px 0 0 0;
            font-size: 1.2em;
            opacity: 0.9;
        }

        nav {
            background-color: #34495e;
            padding: 10px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
        }

        nav ul li {
            margin: 0 15px;
        }

        nav ul li a {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        nav ul li a:hover {
            background-color: #2c3e50;
        }

        section {
            background: white;
            margin: 20px 0;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        section h2 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-top: 0;
        }

        section h3 {
            color: #34495e;
            margin-top: 25px;
            margin-bottom: 15px;
        }

        .code-block {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
        }

        .terminal-output {
            background-color: #1e272e;
            color: #10ac84;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
        }

        .warning {
            background-color: #f39c12;
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 4px solid #e67e22;
        }

        .info {
            background-color: #3498db;
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 4px solid #2980b9;
        }

        .success {
            background-color: #27ae60;
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 4px solid #229954;
        }

        .error {
            background-color: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 4px solid #c0392b;
        }

        .script-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .script-card {
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            padding: 20px;
            background-color: #fff;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .script-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .script-card h3 {
            margin-top: 0;
            color: #2c3e50;
        }

        .feature-list {
            list-style: none;
            padding: 0;
        }

        .feature-list li {
            padding: 5px 0;
            padding-left: 20px;
            position: relative;
        }

        .feature-list li:before {
            content: "‚úì";
            color: #27ae60;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        .step-list {
            counter-reset: step-counter;
        }

        .step-list li {
            counter-increment: step-counter;
            margin-bottom: 10px;
            padding-left: 30px;
            position: relative;
        }

        .step-list li:before {
            content: counter(step-counter);
            background: #3498db;
            color: white;
            font-weight: bold;
            padding: 2px 8px;
            border-radius: 50%;
            position: absolute;
            left: 0;
            top: 0;
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        table th, table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        table th {
            background-color: #f8f9fa;
            color: #2c3e50;
        }

        table tr:hover {
            background-color: #f8f9fa;
        }

        .footer {
            background-color: #34495e;
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 40px;
        }

        @media (max-width: 768px) {
            nav ul {
                flex-direction: column;
                align-items: center;
            }

            nav ul li {
                margin: 5px 0;
            }

            .script-overview {
                grid-template-columns: 1fr;
            }

            header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>üì° Sniff: Analizador de Paquetes de Red</h1>
            <p>Manual de Empleo Completo</p>
        </div>
    </header>

    <nav>
        <div class="container">
            <ul>
                <li><a href="#introduccion">Introducci√≥n</a></li>
                <li><a href="#requisitos">Requisitos</a></li>
                <li><a href="#instalacion">Instalaci√≥n</a></li>
                <li><a href="#scripts">Scripts</a></li>
                <li><a href="#uso">Uso</a></li>
                <li><a href="#troubleshooting">Soluci√≥n Problemas</a></li>
                <li><a href="#configuracion">Configuraci√≥n</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <section id="introduccion">
            <h2>üéØ Introducci√≥n</h2>
            <p>Sniff es una herramienta avanzada de an√°lisis de paquetes de red desarrollada en Python que permite capturar, almacenar y organizar tr√°fico de red para an√°lisis forense detallado. El proyecto consta de tres componentes principales que ofrecen tanto interfaces gr√°ficas como de l√≠nea de comandos.</p>

            <div class="script-overview">
                <div class="script-card">
                    <h3>üîç sniff.py</h3>
                    <p>Aplicaci√≥n principal de captura en tiempo real con interfaz gr√°fica.</p>
                    <ul class="feature-list">
                        <li>Captura de paquetes en vivo</li>
                        <li>Soporte multi-interfaz</li>
                        <li>Almacenamiento dual (MongoDB + PCAP)</li>
                        <li>Interfaz gr√°fica PySide6</li>
                    </ul>
                </div>

                <div class="script-card">
                    <h3>üìä ordenar_paquetes.py</h3>
                    <p>Analizador gr√°fico para organizar paquetes almacenados.</p>
                    <ul class="feature-list">
                        <li>M√∫ltiples m√©todos de ordenamiento</li>
                        <li>Filtrado avanzado por IP</li>
                        <li>Resoluci√≥n DNS autom√°tica</li>
                        <li>An√°lisis conversacional</li>
                    </ul>
                </div>

                <div class="script-card">
                    <h3>‚ö° ordenar_paquetes_sin_entorno_grafico.py</h3>
                    <p>Versi√≥n de l√≠nea de comandos para procesamiento automatizado.</p>
                    <ul class="feature-list">
                        <li>Procesamiento por lotes</li>
                        <li>Generaci√≥n autom√°tica de estad√≠sticas</li>
                        <li>Exportaci√≥n a JSON</li>
                        <li>Optimizado para servidores</li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="requisitos">
            <h2>‚öôÔ∏è Requisitos del Sistema</h2>

            <h3>Software Requerido</h3>
            <table>
                <thead>
                    <tr>
                        <th>Componente</th>
                        <th>Versi√≥n M√≠nima</th>
                        <th>Descripci√≥n</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Python</td>
                        <td>3.7+</td>
                        <td>Lenguaje de programaci√≥n principal</td>
                    </tr>
                    <tr>
                        <td>MongoDB</td>
                        <td>4.0+</td>
                        <td>Base de datos para almacenamiento de paquetes</td>
                    </tr>
                    <tr>
                        <td>Sistema Operativo</td>
                        <td>Linux/MacOS/Windows</td>
                        <td>M√∫ltiples plataformas soportadas</td>
                    </tr>
                </tbody>
            </table>

            <h3>Dependencias Python</h3>
            <div class="code-block">
pip install PySide6>=6.0.0    # Framework de interfaz gr√°fica<br>
pip install scapy>=2.4.0     # Biblioteca de manipulaci√≥n de paquetes<br>
pip install pymongo>=4.0.0   # Driver para MongoDB
            </div>

            <div class="warning">
                <strong>‚ö†Ô∏è IMPORTANTE:</strong> Para captura de paquetes en Linux, necesitar√°s permisos de administrador y configurar las capacidades de red apropiadas.
            </div>
        </section>

        <section id="instalacion">
            <h2>üì¶ Instalaci√≥n y Configuraci√≥n</h2>

            <h3>Paso 1: Instalaci√≥n de MongoDB</h3>
            <div class="info">
                MongoDB es requerido para almacenar los paquetes capturados. Instala la versi√≥n Community Server gratuita.
            </div>

            <h4>Ubuntu/Debian:</h4>
            <div class="code-block">
sudo apt update<br>
sudo apt install -y mongodb<br>
sudo systemctl start mongodb<br>
sudo systemctl enable mongodb
            </div>

            <h4>CentOS/RHEL:</h4>
            <div class="code-block">
sudo yum install -y mongodb<br>
sudo systemctl start mongod<br>
sudo systemctl enable mongod
            </div>

            <h4>MacOS:</h4>
            <div class="code-block">
brew install mongodb-community<br>
brew services start mongodb-community
            </div>

            <h4>Windows:</h4>
            <p>Descarga el instalador MSI desde <a href="https://www.mongodb.com/try/download/community">mongodb.com</a></p>

            <h3>Paso 2: Clonaci√≥n del Proyecto</h3>
            <div class="code-block">
cd /home/nito/Documentos/desarrollo/python<br>
git clone https://github.com/bgonpin/sniff.git<br>
cd sniff
            </div>

            <h3>Paso 3: Configuraci√≥n del Entorno Virtual</h3>
            <div class="code-block">
python3 -m venv venv<br>
source venv/bin/activate  # Linux/Mac<br>
# En Windows: venv\Scripts\activate<br>
pip install --upgrade pip
            </div>

            <h3>Paso 4: Instalaci√≥n de Dependencias</h3>
            <div class="code-block">
pip install pyside6 scapy pymongo
            </div>

            <h3>Paso 5: Configuraci√≥n de Permisos (Linux)</h3>
            <div class="warning">
                Para capturar paquetes, Python necesita acceso a sockets raw. Configura las capacidades de red apropiadas.
            </div>
            <div class="code-block">
sudo setcap cap_net_raw=eip $(which python3)<br>
# Si usas venv, ejecuta desde el directorio del proyecto:<br>
sudo setcap cap_net_raw=eip venv/bin/python3
            </div>

            <h3>Paso 6: Verificaci√≥n de Instalaci√≥n</h3>
            <div class="code-block">
python3 -c "import PySide6.QtWidgets; import scapy.all; import pymongo; print('‚úì Todas las dependencias instaladas correctamente')"
            </div>

            <div class="success">
                <strong>‚úÖ Verificaci√≥n de MongoDB:</strong>
                <div class="code-block">
mongosh  # o mongo en versiones anteriores<br>
use network_sniffing<br>
db.packets.find().limit(1)
                </div>
            </div>
        </section>

        <section id="scripts">
            <h2>üìù Documentaci√≥n de Scripts</h2>

            <h3>1. sniff.py - Capturador de Paquetes Principal</h3>
            <div class="info">
                <strong>Funci√≥n:</strong> Captura paquetes de red en tiempo real y los almacena tanto en MongoDB como en archivos PCAP.
            </div>

            <h4>Caracter√≠sticas T√©cnicas:</h4>
            <ul class="feature-list">
                <li>Uso de AsyncSniffer de Scapy para captura as√≠ncrona</li>
                <li>Procesamiento por lotes de 1000 paquetes para optimizaci√≥n</li>
                <li>Rotaci√≥n autom√°tica de archivos PCAP con timestamps</li>
                <li>Interfaz gr√°fica basada en QThread para evitar bloqueo de UI</li>
                <li>Manejo de excepciones para robustez del sistema</li>
            </ul>

            <h4>Clases Principales:</h4>
            <ul>
                <li><strong>SnifferThread:</strong> Maneja la captura en un hilo separado</li>
                <li><strong>SniffApp:</strong> Interfaz gr√°fica principal</li>
                <li><strong>packet_to_dict:</strong> Conversi√≥n de paquetes Scapy a documentos MongoDB</li>
            </ul>

            <h3>2. ordenar_paquetes.py - Analizador Gr√°fico</h3>
            <div class="info">
                <strong>Funci√≥n:</strong> Analiza y organiza paquetes almacenados en MongoDB con interfaz gr√°fica completa.
            </div>

            <h4>M√©todos de Ordenamiento:</h4>
            <ul class="feature-list">
                <li><strong>sort_by_timestamp():</strong> Orden cronol√≥gico por tiempo de captura</li>
                <li><strong>sort_by_tcp_sequence():</strong> Ordenamiento por n√∫meros de secuencia TCP</li>
                <li><strong>sort_by_conversation():</strong> Agrupaci√≥n por conversaciones bidireccionales</li>
            </ul>

            <h4>Funcionalidades Avanzadas:</h4>
            <ul class="feature-list">
                <li>Filtrado din√°mico por IPs de origen y destino</li>
                <li>Resoluci√≥n DNS autom√°tica con cach√©</li>
                <li>Visualizaci√≥n de estad√≠sticas protocolarias</li>
                <li>Exportaci√≥n de resultados ordenados</li>
            </ul>

            <h3>3. ordenar_paquetes_sin_entorno_grafico.py - Versi√≥n CLI</h3>
            <div class="info">
                <strong>Funci√≥n:</strong> Procesamiento por lotes de paquetes sin interfaz gr√°fica, ideal para servidores y automatizaci√≥n.
            </div>

            <h4>Flujo de Ejecuci√≥n Autom√°tico:</h4>
            <ol class="step-list">
                <li>Carga de paquetes desde MongoDB</li>
                <li>Generaci√≥n de estad√≠sticas base</li>
                <li>Ordenamiento por timestamp</li>
                <li>Ordenamiento por secuencia TCP</li>
                <li>Ordenamiento conversacional</li>
                <li>Exportaci√≥n a JSON</li>
            </ol>
        </section>

        <section id="uso">
            <h2>üöÄ Gu√≠a de Uso</h2>

            <h3>Uso B√°sico - Captura de Paquetes</h3>
            <div class="code-block">
cd /ruta/a/sniff<br>
source venv/bin/activate<br>
python3 sniff.py
            </div>

            <ol class="step-list">
                <li>Seleccionar interfaz de red del listado desplegable</li>
                <li>Hacer clic en "Start Sniffing"</li>
                <li>Observar los paquetes en tiempo real en el √°rea de texto</li>
                <li>Hacer clic en "Stop Sniffing" cuando se termine</li>
            </ol>

            <h3>An√°lisis con Interfaz Gr√°fica</h3>
            <div class="code-block">
python3 ordenar_paquetes.py
            </div>

            <ol class="step-list">
                <li>Clic en "Load Packets from MongoDB"</li>
                <li>Filtrar opcionalmente por IPs (campos opcionales)</li>
                <li>Clic en "Filter and Display Conversations"</li>
                <li>Ver resultados organizados por conversaci√≥n</li>
            </ol>

            <h3>Procesamiento Automatizado (CLI)</h3>
            <div class="code-block">
python3 ordenar_paquetes_sin_entorno_grafico.py
            </div>

            <p>Este script procesa autom√°ticamente todos los paquetes:</p>
            <div class="code-block">
--- Estad√≠sticas ---<br>
Total de paquetes: 2500<br>
Paquetes TCP: 1800<br>
Protocolos encontrados:<br>
  TCP: 1800<br>
  UDP: 650<br>
  ICMP: 50
            </div>

            <h3>Ejemplo de Salida de Di√°logo TCP</h3>
            <div class="terminal-output">
Conversaci√≥n: 192.168.1.100:54321 <-> github.com:443<br>
  1. SEQ: 1000 [SYN] env√≠a host cliente<br>
  2. SEQ: 2000 [SYN,ACK] responde servidor<br>
  3. SEQ: 1001 [ACK] confirma cliente<br>
  4. SEQ: 1002 [ACK] env√≠a datos cliente<br>
  5. SEQ: 2001 [ACK] confirma y env√≠a respuesta servidor
            </div>
        </section>

        <section id="troubleshooting">
            <h2>üîß Soluci√≥n de Problemas</h2>

            <h3>Problema 1: "Permission denied" al iniciar captura</h3>
            <div class="error">
                <strong>Error:</strong> No se pueden capturar paquetes sin permisos administrativos.
            </div>
            <div class="code-block">
# Soluci√≥n - Otorgar capacidades a Python:<br>
sudo setcap cap_net_raw=eip venv/bin/python3<br>
<br>
# Verificar:<br>
getcap venv/bin/python3
            </div>

            <h3>Problema 2: "Connection refused" con MongoDB</h3>
            <div class="error">
                <strong>Error:</strong> MongoDB no est√° ejecut√°ndose o no acepta conexiones.
            </div>
            <div class="code-block">
# Verificar estado del servicio:<br>
sudo systemctl status mongod<br>
<br>
# Iniciar si est√° parado:<br>
sudo systemctl start mongod<br>
<br>
# Verificar conectividad:<br>
mongosh --eval "db.runCommand('ping')"
            </div>

            <h3>Problema 3: "ModuleNotFoundError" para dependencias</h3>
            <div class="error">
                <strong>Error:</strong> Falta alguna dependencia de Python.
            </div>
            <div class="code-block">
# Asegurarse de usar el entorno virtual:<br>
source venv/bin/activate<br>
<br>
# Reinstalar dependencias:<br>
pip install --force-reinstall pyside6 scapy pymongo
            </div>

            <h3>Problema 4: No se muestran interfaces de red</h3>
            <div class="error">
                <strong>Error:</strong> Scapy no puede detectar interfaces disponibles.
            </div>
            <div class="code-block">
# Verificar interfaces disponibles:<br>
python3 -c "from scapy.all import get_if_list; print(get_if_list())"<br>
<br>
# Ejecutar como administrador:<br>
sudo python3 sniff.py
            </div>

            <h3>Problema 5: Aplicaci√≥n GUI no responde</h3>
            <div class="warning">
                <strong>Problema:</strong> La interfaz se congela durante la captura intensiva.
            </div>
            <div class="code-block">
# Soluci√≥n: Ajustar l√≠mites de captura<br>
# En sniff.py l√≠nea ~45<br>
if len(self.packets) == 1000:  # Cambiar a 500 para procesar m√°s frecuentemente
            </div>

            <h3>Problema 6: Memoria insuficiente</h3>
            <div class="warning">
                <strong>Problema:</strong> Acumulando muchos paquetes en memoria.
            </div>
            <div class="code-block">
# Usar procesamiento CLI con l√≠mites:<br>
python3 -c "from ordenar_paquetes_sin_entorno_grafico import PacketSorter; sorter = PacketSorter(); sorter.load_packets(limit=5000); sorter.sort_by_conversation()"
            </div>
        </section>

        <section id="configuracion">
            <h2>‚öôÔ∏è Configuraci√≥n Avanzada</h2>

            <h3>Configuraci√≥n de MongoDB Personalizada</h3>
            <div class="code-block">
# En cualquier script, modificar la inicializaci√≥n:<br>
sorter = PacketSorter(<br>
    mongo_uri="mongodb://usuario:password@localhost:27017",<br>
    db_name="mi_base_datos"<br>)
            </div>

            <h3>Ajuste de Lotes de Procesamiento</h3>
            <div class="code-block">
# En sniff.py l√≠nea ~52:<br>
BATCH_SIZE = 1000  # Ajustar seg√∫n capacidad del sistema<br>
SAVE_INTERVAL_SECONDS = 60  # Forzar guardado peri√≥dico
            </div>

            <h3>Configuraci√≥n de Captura</h3>
            <div class="code-block">
# Filtros opcionales para Scapy:<br>
FILTERS = {<br>
    'tcp': 'tcp port 80 or tcp port 443',<br>
    'udp': 'udp port 53',<br>
    'icmp': 'icmp'<br>}
            </div>

            <h3>Personalizaci√≥n de Salida</h3>
            <div class="code-block">
# Configurar formatos de timestamp:<br>
TIMESTAMP_FORMAT = "%Y-%m-%d %H:%M:%S.%f"<br>
FILENAME_FORMAT = "{timestamp}_capture.pcap"
            </div>

            <h3>Variables de Entorno</h3>
            <div class="code-block">
export MONGODB_URI="mongodb://localhost:27017"<br>
export NETWORK_DB="network_sniffing"<br>
export PCAP_DIR="/var/log/pcaps"<br>
export LOG_LEVEL="INFO"
            </div>
        </section>
    </div>

    <div class="footer">
        <p>&copy; 2025 Sniff Network Analyzer - Desarrollado por bgonpin</p>
        <p>Para m√°s informaci√≥n, visite el <a href="https://github.com/bgonpin/sniff" style="color: #3498db;">repositorio en GitHub</a></p>
    </div>

    <script>
        // Scroll suave para navegaci√≥n interna
        document.addEventListener('DOMContentLoaded', function() {
            const navLinks = document.querySelectorAll('nav a[href^="#"]');

            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        window.scrollTo({
                            top: target.offsetTop - 70,
                            behavior: 'smooth'
                        });
                    }
                });
            });
        });

        // Resaltar secci√≥n activa en navegaci√≥n
        window.addEventListener('scroll', function() {
            const sections = document.querySelectorAll('section[id]');
            const navLinks = document.querySelectorAll('nav a[href^="#"]');

            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 75;
                if (pageYOffset >= sectionTop) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + current) {
                    link.classList.add('active');
                }
            });
        });
    </script>

    <style>
        nav a.active {
            background-color: #2c3e50;
            border-bottom: 2px solid #3498db;
        }
    </style>
</body>
</html>
